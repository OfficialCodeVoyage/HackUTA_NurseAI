{"version":3,"sources":["../../../../src/build/webpack/loaders/next-flight-client-module-loader.ts"],"sourcesContent":["import type { webpack } from 'next/dist/compiled/webpack/webpack'\nimport { getRSCModuleInformation } from '../../analysis/get-page-static-info'\nimport { getModuleBuildInfo } from './get-module-build-info'\n\nconst flightClientModuleLoader: webpack.LoaderDefinitionFunction =\n  function transformSource(this, source: string, sourceMap: any) {\n    // Avoid buffer to be consumed\n    if (typeof source !== 'string') {\n      throw new Error('Expected source to have been transformed to a string.')\n    }\n\n    if (!this._module) {\n      return source\n    }\n    // Assign the RSC meta information to buildInfo.\n    const buildInfo = getModuleBuildInfo(this._module)\n    buildInfo.rsc = getRSCModuleInformation(source, false)\n\n    // This is a server action entry module in the client layer. We need to attach\n    // noop exports of `callServer` wrappers for each action.\n    if (buildInfo.rsc.actions) {\n      return `\nimport { callServer } from 'next/dist/client/app-call-server'\n\nfunction __build_action__(action, args) {\n  return callServer(action.$$id, args)\n}\n\n${source}\n`\n    }\n\n    return this.callback(null, source, sourceMap)\n  }\n\nexport default flightClientModuleLoader\n"],"names":["flightClientModuleLoader","transformSource","source","sourceMap","Error","_module","buildInfo","getModuleBuildInfo","rsc","getRSCModuleInformation","actions","callback"],"mappings":";;;;+BAmCA;;;eAAA;;;mCAlCwC;oCACL;AAEnC,MAAMA,2BACJ,SAASC,gBAAsBC,MAAc,EAAEC,SAAc;IAC3D,8BAA8B;IAC9B,IAAI,OAAOD,WAAW,UAAU;QAC9B,MAAM,IAAIE,MAAM;IAClB;IAEA,IAAI,CAAC,IAAI,CAACC,OAAO,EAAE;QACjB,OAAOH;IACT;IACA,gDAAgD;IAChD,MAAMI,YAAYC,IAAAA,sCAAkB,EAAC,IAAI,CAACF,OAAO;IACjDC,UAAUE,GAAG,GAAGC,IAAAA,0CAAuB,EAACP,QAAQ;IAEhD,8EAA8E;IAC9E,yDAAyD;IACzD,IAAII,UAAUE,GAAG,CAACE,OAAO,EAAE;QACzB,OAAO,CAAC;;;;;;;AAOd,EAAER,OAAO;AACT,CAAC;IACG;IAEA,OAAO,IAAI,CAACS,QAAQ,CAAC,MAAMT,QAAQC;AACrC;MAEF,WAAeH"}