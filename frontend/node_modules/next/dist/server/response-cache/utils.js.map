{"version":3,"sources":["../../../src/server/response-cache/utils.ts"],"sourcesContent":["import type { IncrementalCacheItem, ResponseCacheEntry } from './types'\n\nimport RenderResult from '../render-result'\n\nexport async function fromResponseCacheEntry(\n  cacheEntry: ResponseCacheEntry\n): Promise<IncrementalCacheItem> {\n  return {\n    ...cacheEntry,\n    value:\n      cacheEntry.value?.kind === 'PAGE'\n        ? {\n            kind: 'PAGE',\n            html: await cacheEntry.value.html.toUnchunkedString(true),\n            pageData: cacheEntry.value.pageData,\n            headers: cacheEntry.value.headers,\n            status: cacheEntry.value.status,\n          }\n        : cacheEntry.value?.kind === 'APP_PAGE'\n          ? {\n              kind: 'APP_PAGE',\n              html: await cacheEntry.value.html.toUnchunkedString(true),\n              postponed: cacheEntry.value.postponed,\n              rscData: cacheEntry.value.rscData,\n              headers: cacheEntry.value.headers,\n              status: cacheEntry.value.status,\n            }\n          : cacheEntry.value,\n  }\n}\n\nexport async function toResponseCacheEntry(\n  response: IncrementalCacheItem\n): Promise<ResponseCacheEntry | null> {\n  if (!response) return null\n\n  if (response.value?.kind === 'FETCH') {\n    throw new Error(\n      'Invariant: unexpected cachedResponse of kind fetch in response cache'\n    )\n  }\n\n  return {\n    isMiss: response.isMiss,\n    isStale: response.isStale,\n    revalidate: response.revalidate,\n    value:\n      response.value?.kind === 'PAGE'\n        ? {\n            kind: 'PAGE',\n            html: RenderResult.fromStatic(response.value.html),\n            pageData: response.value.pageData,\n            headers: response.value.headers,\n            status: response.value.status,\n          }\n        : response.value?.kind === 'APP_PAGE'\n          ? {\n              kind: 'APP_PAGE',\n              html: RenderResult.fromStatic(response.value.html),\n              rscData: response.value.rscData,\n              headers: response.value.headers,\n              status: response.value.status,\n              postponed: response.value.postponed,\n            }\n          : response.value,\n  }\n}\n"],"names":["fromResponseCacheEntry","toResponseCacheEntry","cacheEntry","value","kind","html","toUnchunkedString","pageData","headers","status","postponed","rscData","response","Error","isMiss","isStale","revalidate","RenderResult","fromStatic"],"mappings":";;;;;;;;;;;;;;;IAIsBA,sBAAsB;eAAtBA;;IA2BAC,oBAAoB;eAApBA;;;qEA7BG;;;;;;AAElB,eAAeD,uBACpBE,UAA8B;QAK1BA,mBAQIA;IAXR,OAAO;QACL,GAAGA,UAAU;QACbC,OACED,EAAAA,oBAAAA,WAAWC,KAAK,qBAAhBD,kBAAkBE,IAAI,MAAK,SACvB;YACEA,MAAM;YACNC,MAAM,MAAMH,WAAWC,KAAK,CAACE,IAAI,CAACC,iBAAiB,CAAC;YACpDC,UAAUL,WAAWC,KAAK,CAACI,QAAQ;YACnCC,SAASN,WAAWC,KAAK,CAACK,OAAO;YACjCC,QAAQP,WAAWC,KAAK,CAACM,MAAM;QACjC,IACAP,EAAAA,qBAAAA,WAAWC,KAAK,qBAAhBD,mBAAkBE,IAAI,MAAK,aACzB;YACEA,MAAM;YACNC,MAAM,MAAMH,WAAWC,KAAK,CAACE,IAAI,CAACC,iBAAiB,CAAC;YACpDI,WAAWR,WAAWC,KAAK,CAACO,SAAS;YACrCC,SAAST,WAAWC,KAAK,CAACQ,OAAO;YACjCH,SAASN,WAAWC,KAAK,CAACK,OAAO;YACjCC,QAAQP,WAAWC,KAAK,CAACM,MAAM;QACjC,IACAP,WAAWC,KAAK;IAC1B;AACF;AAEO,eAAeF,qBACpBW,QAA8B;QAI1BA,iBAWAA,kBAQIA;IArBR,IAAI,CAACA,UAAU,OAAO;IAEtB,IAAIA,EAAAA,kBAAAA,SAAST,KAAK,qBAAdS,gBAAgBR,IAAI,MAAK,SAAS;QACpC,MAAM,IAAIS,MACR;IAEJ;IAEA,OAAO;QACLC,QAAQF,SAASE,MAAM;QACvBC,SAASH,SAASG,OAAO;QACzBC,YAAYJ,SAASI,UAAU;QAC/Bb,OACES,EAAAA,mBAAAA,SAAST,KAAK,qBAAdS,iBAAgBR,IAAI,MAAK,SACrB;YACEA,MAAM;YACNC,MAAMY,qBAAY,CAACC,UAAU,CAACN,SAAST,KAAK,CAACE,IAAI;YACjDE,UAAUK,SAAST,KAAK,CAACI,QAAQ;YACjCC,SAASI,SAAST,KAAK,CAACK,OAAO;YAC/BC,QAAQG,SAAST,KAAK,CAACM,MAAM;QAC/B,IACAG,EAAAA,mBAAAA,SAAST,KAAK,qBAAdS,iBAAgBR,IAAI,MAAK,aACvB;YACEA,MAAM;YACNC,MAAMY,qBAAY,CAACC,UAAU,CAACN,SAAST,KAAK,CAACE,IAAI;YACjDM,SAASC,SAAST,KAAK,CAACQ,OAAO;YAC/BH,SAASI,SAAST,KAAK,CAACK,OAAO;YAC/BC,QAAQG,SAAST,KAAK,CAACM,MAAM;YAC7BC,WAAWE,SAAST,KAAK,CAACO,SAAS;QACrC,IACAE,SAAST,KAAK;IACxB;AACF"}