{"version":3,"sources":["../../src/client/index.tsx"],"sourcesContent":["/* global location */\nimport '../build/polyfills/polyfill-module'\n\nimport type Router from '../shared/lib/router/router'\nimport type {\n  AppComponent,\n  AppProps,\n  PrivateRouteInfo,\n} from '../shared/lib/router/router'\n\nimport React, { type JSX } from 'react'\nimport ReactDOM from 'react-dom/client'\nimport { HeadManagerContext } from '../shared/lib/head-manager-context.shared-runtime'\nimport mitt from '../shared/lib/mitt'\nimport type { MittEmitter } from '../shared/lib/mitt'\nimport { RouterContext } from '../shared/lib/router-context.shared-runtime'\nimport { handleSmoothScroll } from '../shared/lib/router/utils/handle-smooth-scroll'\nimport { isDynamicRoute } from '../shared/lib/router/utils/is-dynamic'\nimport {\n  urlQueryToSearchParams,\n  assign,\n} from '../shared/lib/router/utils/querystring'\nimport { setConfig } from '../shared/lib/runtime-config.external'\nimport { getURL, loadGetInitialProps, ST } from '../shared/lib/utils'\nimport type { NextWebVitalsMetric, NEXT_DATA } from '../shared/lib/utils'\nimport { Portal } from './portal'\nimport initHeadManager from './head-manager'\nimport PageLoader from './page-loader'\nimport type { StyleSheetTuple } from './page-loader'\nimport { RouteAnnouncer } from './route-announcer'\nimport { createRouter, makePublicRouterInstance } from './router'\nimport { getProperError } from '../lib/is-error'\nimport { ImageConfigContext } from '../shared/lib/image-config-context.shared-runtime'\nimport type { ImageConfigComplete } from '../shared/lib/image-config'\nimport { removeBasePath } from './remove-base-path'\nimport { hasBasePath } from './has-base-path'\nimport { AppRouterContext } from '../shared/lib/app-router-context.shared-runtime'\nimport {\n  adaptForAppRouterInstance,\n  adaptForPathParams,\n  adaptForSearchParams,\n  PathnameContextProviderAdapter,\n} from '../shared/lib/router/adapters'\nimport {\n  SearchParamsContext,\n  PathParamsContext,\n} from '../shared/lib/hooks-client-context.shared-runtime'\nimport { onRecoverableError } from './on-recoverable-error'\nimport tracer from './tracing/tracer'\nimport reportToSocket from './tracing/report-to-socket'\n\n/// <reference types=\"react-dom/experimental\" />\n\ndeclare global {\n  interface Window {\n    /* test fns */\n    __NEXT_HYDRATED?: boolean\n    __NEXT_HYDRATED_CB?: () => void\n\n    /* prod */\n    __NEXT_DATA__: NEXT_DATA\n    __NEXT_P: any[]\n  }\n}\ntype RenderRouteInfo = PrivateRouteInfo & {\n  App: AppComponent\n  scroll?: { x: number; y: number } | null\n  isHydratePass?: boolean\n}\ntype RenderErrorProps = Omit<RenderRouteInfo, 'Component' | 'styleSheets'>\ntype RegisterFn = (input: [string, () => void]) => void\n\nexport const version = process.env.__NEXT_VERSION\nexport let router: Router\nexport const emitter: MittEmitter<string> = mitt()\n\nconst looseToArray = <T extends {}>(input: any): T[] => [].slice.call(input)\n\nlet initialData: NEXT_DATA\nlet defaultLocale: string | undefined = undefined\nlet asPath: string\nlet pageLoader: PageLoader\nlet appElement: HTMLElement | null\nlet headManager: {\n  mountedInstances: Set<unknown>\n  updateHead: (head: JSX.Element[]) => void\n  getIsSsr?: () => boolean\n}\nlet initialMatchesMiddleware = false\nlet lastAppProps: AppProps\n\nlet lastRenderReject: (() => void) | null\nlet devClient: any\n\nlet CachedApp: AppComponent, onPerfEntry: (metric: any) => void\nlet CachedComponent: React.ComponentType\n\nclass Container extends React.Component<{\n  children?: React.ReactNode\n  fn: (err: Error, info?: any) => void\n}> {\n  componentDidCatch(componentErr: Error, info: any) {\n    this.props.fn(componentErr, info)\n  }\n\n  componentDidMount() {\n    this.scrollToHash()\n\n    // We need to replace the router state if:\n    // - the page was (auto) exported and has a query string or search (hash)\n    // - it was auto exported and is a dynamic route (to provide params)\n    // - if it is a client-side skeleton (fallback render)\n    // - if middleware matches the current page (may have rewrite params)\n    // - if rewrites in next.config.js match (may have rewrite params)\n    if (\n      router.isSsr &&\n      (initialData.isFallback ||\n        (initialData.nextExport &&\n          (isDynamicRoute(router.pathname) ||\n            location.search ||\n            process.env.__NEXT_HAS_REWRITES ||\n            initialMatchesMiddleware)) ||\n        (initialData.props &&\n          initialData.props.__N_SSG &&\n          (location.search ||\n            process.env.__NEXT_HAS_REWRITES ||\n            initialMatchesMiddleware)))\n    ) {\n      // update query on mount for exported pages\n      router\n        .replace(\n          router.pathname +\n            '?' +\n            String(\n              assign(\n                urlQueryToSearchParams(router.query),\n                new URLSearchParams(location.search)\n              )\n            ),\n          asPath,\n          {\n            // @ts-ignore\n            // WARNING: `_h` is an internal option for handing Next.js\n            // client-side hydration. Your app should _never_ use this property.\n            // It may change at any time without notice.\n            _h: 1,\n            // Fallback pages must trigger the data fetch, so the transition is\n            // not shallow.\n            // Other pages (strictly updating query) happens shallowly, as data\n            // requirements would already be present.\n            shallow: !initialData.isFallback && !initialMatchesMiddleware,\n          }\n        )\n        .catch((err) => {\n          if (!err.cancelled) throw err\n        })\n    }\n  }\n\n  componentDidUpdate() {\n    this.scrollToHash()\n  }\n\n  scrollToHash() {\n    let { hash } = location\n    hash = hash && hash.substring(1)\n    if (!hash) return\n\n    const el: HTMLElement | null = document.getElementById(hash)\n    if (!el) return\n\n    // If we call scrollIntoView() in here without a setTimeout\n    // it won't scroll properly.\n    setTimeout(() => el.scrollIntoView(), 0)\n  }\n\n  render() {\n    if (process.env.NODE_ENV === 'production') {\n      return this.props.children\n    } else {\n      const ReactDevOverlay: typeof import('./components/react-dev-overlay/pages/client').ReactDevOverlay =\n        require('./components/react-dev-overlay/pages/client').ReactDevOverlay\n      return <ReactDevOverlay>{this.props.children}</ReactDevOverlay>\n    }\n  }\n}\n\nexport async function initialize(opts: { devClient?: any } = {}): Promise<{\n  assetPrefix: string\n}> {\n  tracer.onSpanEnd(reportToSocket)\n\n  // This makes sure this specific lines are removed in production\n  if (process.env.NODE_ENV === 'development') {\n    devClient = opts.devClient\n  }\n\n  initialData = JSON.parse(\n    document.getElementById('__NEXT_DATA__')!.textContent!\n  )\n  window.__NEXT_DATA__ = initialData\n\n  defaultLocale = initialData.defaultLocale\n  const prefix: string = initialData.assetPrefix || ''\n  // With dynamic assetPrefix it's no longer possible to set assetPrefix at the build time\n  // So, this is how we do it in the client side at runtime\n  ;(self as any).__next_set_public_path__(`${prefix}/_next/`) //eslint-disable-line\n\n  // Initialize next/config with the environment configuration\n  setConfig({\n    serverRuntimeConfig: {},\n    publicRuntimeConfig: initialData.runtimeConfig || {},\n  })\n\n  asPath = getURL()\n\n  // make sure not to attempt stripping basePath for 404s\n  if (hasBasePath(asPath)) {\n    asPath = removeBasePath(asPath)\n  }\n\n  if (process.env.__NEXT_I18N_SUPPORT) {\n    const { normalizeLocalePath } =\n      require('../shared/lib/i18n/normalize-locale-path') as typeof import('../shared/lib/i18n/normalize-locale-path')\n\n    const { detectDomainLocale } =\n      require('../shared/lib/i18n/detect-domain-locale') as typeof import('../shared/lib/i18n/detect-domain-locale')\n\n    const { parseRelativeUrl } =\n      require('../shared/lib/router/utils/parse-relative-url') as typeof import('../shared/lib/router/utils/parse-relative-url')\n\n    const { formatUrl } =\n      require('../shared/lib/router/utils/format-url') as typeof import('../shared/lib/router/utils/format-url')\n\n    if (initialData.locales) {\n      const parsedAs = parseRelativeUrl(asPath)\n      const localePathResult = normalizeLocalePath(\n        parsedAs.pathname,\n        initialData.locales\n      )\n\n      if (localePathResult.detectedLocale) {\n        parsedAs.pathname = localePathResult.pathname\n        asPath = formatUrl(parsedAs)\n      } else {\n        // derive the default locale if it wasn't detected in the asPath\n        // since we don't prerender static pages with all possible default\n        // locales\n        defaultLocale = initialData.locale\n      }\n\n      // attempt detecting default locale based on hostname\n      const detectedDomain = detectDomainLocale(\n        process.env.__NEXT_I18N_DOMAINS as any,\n        window.location.hostname\n      )\n\n      // TODO: investigate if defaultLocale needs to be populated after\n      // hydration to prevent mismatched renders\n      if (detectedDomain) {\n        defaultLocale = detectedDomain.defaultLocale\n      }\n    }\n  }\n\n  if (initialData.scriptLoader) {\n    const { initScriptLoader } = require('./script')\n    initScriptLoader(initialData.scriptLoader)\n  }\n\n  pageLoader = new PageLoader(initialData.buildId, prefix)\n\n  const register: RegisterFn = ([r, f]) =>\n    pageLoader.routeLoader.onEntrypoint(r, f)\n  if (window.__NEXT_P) {\n    // Defer page registration for another tick. This will increase the overall\n    // latency in hydrating the page, but reduce the total blocking time.\n    window.__NEXT_P.map((p) => setTimeout(() => register(p), 0))\n  }\n  window.__NEXT_P = []\n  ;(window.__NEXT_P as any).push = register\n\n  headManager = initHeadManager()\n  headManager.getIsSsr = () => {\n    return router.isSsr\n  }\n\n  appElement = document.getElementById('__next')\n  return { assetPrefix: prefix }\n}\n\nfunction renderApp(App: AppComponent, appProps: AppProps) {\n  return <App {...appProps} />\n}\n\nfunction AppContainer({\n  children,\n}: React.PropsWithChildren<{}>): React.ReactElement {\n  // Create a memoized value for next/navigation router context.\n  const adaptedForAppRouter = React.useMemo(() => {\n    return adaptForAppRouterInstance(router)\n  }, [])\n  return (\n    <Container\n      fn={(error) =>\n        // TODO: Fix disabled eslint rule\n        // eslint-disable-next-line @typescript-eslint/no-use-before-define\n        renderError({ App: CachedApp, err: error }).catch((err) =>\n          console.error('Error rendering page: ', err)\n        )\n      }\n    >\n      <AppRouterContext.Provider value={adaptedForAppRouter}>\n        <SearchParamsContext.Provider value={adaptForSearchParams(router)}>\n          <PathnameContextProviderAdapter\n            router={router}\n            isAutoExport={self.__NEXT_DATA__.autoExport ?? false}\n          >\n            <PathParamsContext.Provider value={adaptForPathParams(router)}>\n              <RouterContext.Provider value={makePublicRouterInstance(router)}>\n                <HeadManagerContext.Provider value={headManager}>\n                  <ImageConfigContext.Provider\n                    value={\n                      process.env\n                        .__NEXT_IMAGE_OPTS as any as ImageConfigComplete\n                    }\n                  >\n                    {children}\n                  </ImageConfigContext.Provider>\n                </HeadManagerContext.Provider>\n              </RouterContext.Provider>\n            </PathParamsContext.Provider>\n          </PathnameContextProviderAdapter>\n        </SearchParamsContext.Provider>\n      </AppRouterContext.Provider>\n    </Container>\n  )\n}\n\nconst wrapApp =\n  (App: AppComponent) =>\n  (wrappedAppProps: Record<string, any>): JSX.Element => {\n    const appProps: AppProps = {\n      ...wrappedAppProps,\n      Component: CachedComponent,\n      err: initialData.err,\n      router,\n    }\n    return <AppContainer>{renderApp(App, appProps)}</AppContainer>\n  }\n\n// This method handles all runtime and debug errors.\n// 404 and 500 errors are special kind of errors\n// and they are still handle via the main render method.\nfunction renderError(renderErrorProps: RenderErrorProps): Promise<any> {\n  let { App, err } = renderErrorProps\n\n  // In development runtime errors are caught by our overlay\n  // In production we catch runtime errors using componentDidCatch which will trigger renderError\n  if (process.env.NODE_ENV !== 'production') {\n    // A Next.js rendering runtime error is always unrecoverable\n    // FIXME: let's make this recoverable (error in GIP client-transition)\n    devClient.onUnrecoverableError()\n\n    // We need to render an empty <App> so that the `<ReactDevOverlay>` can\n    // render itself.\n    // TODO: Fix disabled eslint rule\n    // eslint-disable-next-line @typescript-eslint/no-use-before-define\n    return doRender({\n      App: () => null,\n      props: {},\n      Component: () => null,\n      styleSheets: [],\n    })\n  }\n\n  // Make sure we log the error to the console, otherwise users can't track down issues.\n  console.error(err)\n  console.error(\n    `A client-side exception has occurred, see here for more info: https://nextjs.org/docs/messages/client-side-exception-occurred`\n  )\n\n  return pageLoader\n    .loadPage('/_error')\n    .then(({ page: ErrorComponent, styleSheets }) => {\n      return lastAppProps?.Component === ErrorComponent\n        ? import('../pages/_error')\n            .then((errorModule) => {\n              return import('../pages/_app').then((appModule) => {\n                App = appModule.default as any as AppComponent\n                renderErrorProps.App = App\n                return errorModule\n              })\n            })\n            .then((m) => ({\n              ErrorComponent: m.default as React.ComponentType<{}>,\n              styleSheets: [],\n            }))\n        : { ErrorComponent, styleSheets }\n    })\n    .then(({ ErrorComponent, styleSheets }) => {\n      // In production we do a normal render with the `ErrorComponent` as component.\n      // If we've gotten here upon initial render, we can use the props from the server.\n      // Otherwise, we need to call `getInitialProps` on `App` before mounting.\n      const AppTree = wrapApp(App)\n      const appCtx = {\n        Component: ErrorComponent,\n        AppTree,\n        router,\n        ctx: {\n          err,\n          pathname: initialData.page,\n          query: initialData.query,\n          asPath,\n          AppTree,\n        },\n      }\n      return Promise.resolve(\n        renderErrorProps.props?.err\n          ? renderErrorProps.props\n          : loadGetInitialProps(App, appCtx)\n      ).then((initProps) =>\n        // TODO: Fix disabled eslint rule\n        // eslint-disable-next-line @typescript-eslint/no-use-before-define\n        doRender({\n          ...renderErrorProps,\n          err,\n          Component: ErrorComponent,\n          styleSheets,\n          props: initProps,\n        })\n      )\n    })\n}\n\n// Dummy component that we render as a child of Root so that we can\n// toggle the correct styles before the page is rendered.\nfunction Head({ callback }: { callback: () => void }): null {\n  // We use `useLayoutEffect` to guarantee the callback is executed\n  // as soon as React flushes the update.\n  React.useLayoutEffect(() => callback(), [callback])\n  return null\n}\n\nconst performanceMarks = {\n  navigationStart: 'navigationStart',\n  beforeRender: 'beforeRender',\n  afterRender: 'afterRender',\n  afterHydrate: 'afterHydrate',\n  routeChange: 'routeChange',\n} as const\n\nconst performanceMeasures = {\n  hydration: 'Next.js-hydration',\n  beforeHydration: 'Next.js-before-hydration',\n  routeChangeToRender: 'Next.js-route-change-to-render',\n  render: 'Next.js-render',\n} as const\n\nlet reactRoot: any = null\n// On initial render a hydrate should always happen\nlet shouldHydrate: boolean = true\n\nfunction clearMarks(): void {\n  ;[\n    performanceMarks.beforeRender,\n    performanceMarks.afterHydrate,\n    performanceMarks.afterRender,\n    performanceMarks.routeChange,\n  ].forEach((mark) => performance.clearMarks(mark))\n}\n\nfunction markHydrateComplete(): void {\n  if (!ST) return\n\n  performance.mark(performanceMarks.afterHydrate) // mark end of hydration\n\n  const hasBeforeRenderMark = performance.getEntriesByName(\n    performanceMarks.beforeRender,\n    'mark'\n  ).length\n  if (hasBeforeRenderMark) {\n    const beforeHydrationMeasure = performance.measure(\n      performanceMeasures.beforeHydration,\n      performanceMarks.navigationStart,\n      performanceMarks.beforeRender\n    )\n\n    const hydrationMeasure = performance.measure(\n      performanceMeasures.hydration,\n      performanceMarks.beforeRender,\n      performanceMarks.afterHydrate\n    )\n\n    if (\n      process.env.NODE_ENV === 'development' &&\n      // Old versions of Safari don't return `PerformanceMeasure`s from `performance.measure()`\n      beforeHydrationMeasure !== undefined &&\n      hydrationMeasure !== undefined\n    ) {\n      tracer\n        .startSpan('navigation-to-hydration', {\n          startTime: performance.timeOrigin + beforeHydrationMeasure.startTime,\n          attributes: {\n            pathname: location.pathname,\n            query: location.search,\n          },\n        })\n        .end(\n          performance.timeOrigin +\n            hydrationMeasure.startTime +\n            hydrationMeasure.duration\n        )\n    }\n  }\n\n  if (onPerfEntry) {\n    performance\n      .getEntriesByName(performanceMeasures.hydration)\n      .forEach(onPerfEntry)\n  }\n  clearMarks()\n}\n\nfunction markRenderComplete(): void {\n  if (!ST) return\n\n  performance.mark(performanceMarks.afterRender) // mark end of render\n  const navStartEntries: PerformanceEntryList = performance.getEntriesByName(\n    performanceMarks.routeChange,\n    'mark'\n  )\n\n  if (!navStartEntries.length) return\n\n  const hasBeforeRenderMark = performance.getEntriesByName(\n    performanceMarks.beforeRender,\n    'mark'\n  ).length\n\n  if (hasBeforeRenderMark) {\n    performance.measure(\n      performanceMeasures.routeChangeToRender,\n      navStartEntries[0].name,\n      performanceMarks.beforeRender\n    )\n    performance.measure(\n      performanceMeasures.render,\n      performanceMarks.beforeRender,\n      performanceMarks.afterRender\n    )\n    if (onPerfEntry) {\n      performance\n        .getEntriesByName(performanceMeasures.render)\n        .forEach(onPerfEntry)\n      performance\n        .getEntriesByName(performanceMeasures.routeChangeToRender)\n        .forEach(onPerfEntry)\n    }\n  }\n\n  clearMarks()\n  ;[\n    performanceMeasures.routeChangeToRender,\n    performanceMeasures.render,\n  ].forEach((measure) => performance.clearMeasures(measure))\n}\n\nfunction renderReactElement(\n  domEl: HTMLElement,\n  fn: (cb: () => void) => JSX.Element\n): void {\n  // mark start of hydrate/render\n  if (ST) {\n    performance.mark(performanceMarks.beforeRender)\n  }\n\n  const reactEl = fn(shouldHydrate ? markHydrateComplete : markRenderComplete)\n  if (!reactRoot) {\n    // Unlike with createRoot, you don't need a separate root.render() call here\n    reactRoot = ReactDOM.hydrateRoot(domEl, reactEl, {\n      onRecoverableError,\n    })\n    // TODO: Remove shouldHydrate variable when React 18 is stable as it can depend on `reactRoot` existing\n    shouldHydrate = false\n  } else {\n    const startTransition = (React as any).startTransition\n    startTransition(() => {\n      reactRoot.render(reactEl)\n    })\n  }\n}\n\nfunction Root({\n  callbacks,\n  children,\n}: React.PropsWithChildren<{\n  callbacks: Array<() => void>\n}>): React.ReactElement {\n  // We use `useLayoutEffect` to guarantee the callbacks are executed\n  // as soon as React flushes the update\n  React.useLayoutEffect(\n    () => callbacks.forEach((callback) => callback()),\n    [callbacks]\n  )\n\n  if (process.env.__NEXT_TEST_MODE) {\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    React.useEffect(() => {\n      window.__NEXT_HYDRATED = true\n\n      if (window.__NEXT_HYDRATED_CB) {\n        window.__NEXT_HYDRATED_CB()\n      }\n    }, [])\n  }\n\n  return children as React.ReactElement\n}\n\nfunction doRender(input: RenderRouteInfo): Promise<any> {\n  let { App, Component, props, err }: RenderRouteInfo = input\n  let styleSheets: StyleSheetTuple[] | undefined =\n    'initial' in input ? undefined : input.styleSheets\n  Component = Component || lastAppProps.Component\n  props = props || lastAppProps.props\n\n  const appProps: AppProps = {\n    ...props,\n    Component,\n    err,\n    router,\n  }\n  // lastAppProps has to be set before ReactDom.render to account for ReactDom throwing an error.\n  lastAppProps = appProps\n\n  let canceled: boolean = false\n  let resolvePromise: () => void\n  const renderPromise = new Promise<void>((resolve, reject) => {\n    if (lastRenderReject) {\n      lastRenderReject()\n    }\n    resolvePromise = () => {\n      lastRenderReject = null\n      resolve()\n    }\n    lastRenderReject = () => {\n      canceled = true\n      lastRenderReject = null\n\n      const error: any = new Error('Cancel rendering route')\n      error.cancelled = true\n      reject(error)\n    }\n  })\n\n  // This function has a return type to ensure it doesn't start returning a\n  // Promise. It should remain synchronous.\n  function onStart(): boolean {\n    if (\n      !styleSheets ||\n      // We use `style-loader` in development, so we don't need to do anything\n      // unless we're in production:\n      process.env.NODE_ENV !== 'production'\n    ) {\n      return false\n    }\n\n    const currentStyleTags: HTMLStyleElement[] = looseToArray<HTMLStyleElement>(\n      document.querySelectorAll('style[data-n-href]')\n    )\n    const currentHrefs: Set<string | null> = new Set(\n      currentStyleTags.map((tag) => tag.getAttribute('data-n-href'))\n    )\n\n    const noscript: Element | null = document.querySelector(\n      'noscript[data-n-css]'\n    )\n    const nonce: string | null | undefined =\n      noscript?.getAttribute('data-n-css')\n\n    styleSheets.forEach(({ href, text }: { href: string; text: any }) => {\n      if (!currentHrefs.has(href)) {\n        const styleTag = document.createElement('style')\n        styleTag.setAttribute('data-n-href', href)\n        styleTag.setAttribute('media', 'x')\n\n        if (nonce) {\n          styleTag.setAttribute('nonce', nonce)\n        }\n\n        document.head.appendChild(styleTag)\n        styleTag.appendChild(document.createTextNode(text))\n      }\n    })\n    return true\n  }\n\n  function onHeadCommit(): void {\n    if (\n      // We use `style-loader` in development, so we don't need to do anything\n      // unless we're in production:\n      process.env.NODE_ENV === 'production' &&\n      // We can skip this during hydration. Running it wont cause any harm, but\n      // we may as well save the CPU cycles:\n      styleSheets &&\n      // Ensure this render was not canceled\n      !canceled\n    ) {\n      const desiredHrefs: Set<string> = new Set(styleSheets.map((s) => s.href))\n      const currentStyleTags: HTMLStyleElement[] =\n        looseToArray<HTMLStyleElement>(\n          document.querySelectorAll('style[data-n-href]')\n        )\n      const currentHrefs: string[] = currentStyleTags.map(\n        (tag) => tag.getAttribute('data-n-href')!\n      )\n\n      // Toggle `<style>` tags on or off depending on if they're needed:\n      for (let idx = 0; idx < currentHrefs.length; ++idx) {\n        if (desiredHrefs.has(currentHrefs[idx])) {\n          currentStyleTags[idx].removeAttribute('media')\n        } else {\n          currentStyleTags[idx].setAttribute('media', 'x')\n        }\n      }\n\n      // Reorder styles into intended order:\n      let referenceNode: Element | null = document.querySelector(\n        'noscript[data-n-css]'\n      )\n      if (\n        // This should be an invariant:\n        referenceNode\n      ) {\n        styleSheets.forEach(({ href }: { href: string }) => {\n          const targetTag: Element | null = document.querySelector(\n            `style[data-n-href=\"${href}\"]`\n          )\n          if (\n            // This should be an invariant:\n            targetTag\n          ) {\n            referenceNode!.parentNode!.insertBefore(\n              targetTag,\n              referenceNode!.nextSibling\n            )\n            referenceNode = targetTag\n          }\n        })\n      }\n\n      // Finally, clean up server rendered stylesheets:\n      looseToArray<HTMLLinkElement>(\n        document.querySelectorAll('link[data-n-p]')\n      ).forEach((el) => {\n        el.parentNode!.removeChild(el)\n      })\n    }\n\n    if (input.scroll) {\n      const { x, y } = input.scroll\n      handleSmoothScroll(() => {\n        window.scrollTo(x, y)\n      })\n    }\n  }\n\n  function onRootCommit(): void {\n    resolvePromise()\n  }\n\n  onStart()\n\n  const elem: JSX.Element = (\n    <>\n      <Head callback={onHeadCommit} />\n      <AppContainer>\n        {renderApp(App, appProps)}\n        <Portal type=\"next-route-announcer\">\n          <RouteAnnouncer />\n        </Portal>\n      </AppContainer>\n    </>\n  )\n\n  // We catch runtime errors using componentDidCatch which will trigger renderError\n  renderReactElement(appElement!, (callback) => (\n    <Root callbacks={[callback, onRootCommit]}>\n      {process.env.__NEXT_STRICT_MODE ? (\n        <React.StrictMode>{elem}</React.StrictMode>\n      ) : (\n        elem\n      )}\n    </Root>\n  ))\n\n  return renderPromise\n}\n\nasync function render(renderingProps: RenderRouteInfo): Promise<void> {\n  // if an error occurs in a server-side page (e.g. in getInitialProps),\n  // skip re-rendering the error page client-side as data-fetching operations\n  // will already have been done on the server and NEXT_DATA contains the correct\n  // data for straight-forward hydration of the error page\n  if (\n    renderingProps.err &&\n    // renderingProps.Component might be undefined if there is a top/module-level error\n    (typeof renderingProps.Component === 'undefined' ||\n      !renderingProps.isHydratePass)\n  ) {\n    await renderError(renderingProps)\n    return\n  }\n\n  try {\n    await doRender(renderingProps)\n  } catch (err) {\n    const renderErr = getProperError(err)\n    // bubble up cancelation errors\n    if ((renderErr as Error & { cancelled?: boolean }).cancelled) {\n      throw renderErr\n    }\n\n    if (process.env.NODE_ENV === 'development') {\n      // Ensure this error is displayed in the overlay in development\n      setTimeout(() => {\n        throw renderErr\n      })\n    }\n    await renderError({ ...renderingProps, err: renderErr })\n  }\n}\n\nexport async function hydrate(opts?: { beforeRender?: () => Promise<void> }) {\n  let initialErr = initialData.err\n\n  try {\n    const appEntrypoint = await pageLoader.routeLoader.whenEntrypoint('/_app')\n    if ('error' in appEntrypoint) {\n      throw appEntrypoint.error\n    }\n\n    const { component: app, exports: mod } = appEntrypoint\n    CachedApp = app as AppComponent\n    if (mod && mod.reportWebVitals) {\n      onPerfEntry = ({\n        id,\n        name,\n        startTime,\n        value,\n        duration,\n        entryType,\n        entries,\n        attribution,\n      }: any): void => {\n        // Combines timestamp with random number for unique ID\n        const uniqueID: string = `${Date.now()}-${\n          Math.floor(Math.random() * (9e12 - 1)) + 1e12\n        }`\n        let perfStartEntry: string | undefined\n\n        if (entries && entries.length) {\n          perfStartEntry = entries[0].startTime\n        }\n\n        const webVitals: NextWebVitalsMetric = {\n          id: id || uniqueID,\n          name,\n          startTime: startTime || perfStartEntry,\n          value: value == null ? duration : value,\n          label:\n            entryType === 'mark' || entryType === 'measure'\n              ? 'custom'\n              : 'web-vital',\n        }\n        if (attribution) {\n          webVitals.attribution = attribution\n        }\n        mod.reportWebVitals(webVitals)\n      }\n    }\n\n    const pageEntrypoint =\n      // The dev server fails to serve script assets when there's a hydration\n      // error, so we need to skip waiting for the entrypoint.\n      process.env.NODE_ENV === 'development' && initialData.err\n        ? { error: initialData.err }\n        : await pageLoader.routeLoader.whenEntrypoint(initialData.page)\n    if ('error' in pageEntrypoint) {\n      throw pageEntrypoint.error\n    }\n    CachedComponent = pageEntrypoint.component\n\n    if (process.env.NODE_ENV !== 'production') {\n      const { isValidElementType } = require('next/dist/compiled/react-is')\n      if (!isValidElementType(CachedComponent)) {\n        throw new Error(\n          `The default export is not a React Component in page: \"${initialData.page}\"`\n        )\n      }\n    }\n  } catch (error) {\n    // This catches errors like throwing in the top level of a module\n    initialErr = getProperError(error)\n  }\n\n  if (process.env.NODE_ENV === 'development') {\n    const getServerError: typeof import('./components/react-dev-overlay/pages/client').getServerError =\n      require('./components/react-dev-overlay/pages/client').getServerError\n    // Server-side runtime errors need to be re-thrown on the client-side so\n    // that the overlay is rendered.\n    if (initialErr) {\n      if (initialErr === initialData.err) {\n        setTimeout(() => {\n          let error\n          try {\n            // Generate a new error object. We `throw` it because some browsers\n            // will set the `stack` when thrown, and we want to ensure ours is\n            // not overridden when we re-throw it below.\n            throw new Error(initialErr!.message)\n          } catch (e) {\n            error = e as Error\n          }\n\n          error.name = initialErr!.name\n          error.stack = initialErr!.stack\n          throw getServerError(error, initialErr!.source!)\n        })\n      }\n      // We replaced the server-side error with a client-side error, and should\n      // no longer rewrite the stack trace to a Node error.\n      else {\n        setTimeout(() => {\n          throw initialErr\n        })\n      }\n    }\n  }\n\n  if (window.__NEXT_PRELOADREADY) {\n    await window.__NEXT_PRELOADREADY(initialData.dynamicIds)\n  }\n\n  router = createRouter(initialData.page, initialData.query, asPath, {\n    initialProps: initialData.props,\n    pageLoader,\n    App: CachedApp,\n    Component: CachedComponent,\n    wrapApp,\n    err: initialErr,\n    isFallback: Boolean(initialData.isFallback),\n    subscription: (info, App, scroll) =>\n      render(\n        Object.assign<\n          {},\n          Omit<RenderRouteInfo, 'App' | 'scroll'>,\n          Pick<RenderRouteInfo, 'App' | 'scroll'>\n        >({}, info, {\n          App,\n          scroll,\n        }) as RenderRouteInfo\n      ),\n    locale: initialData.locale,\n    locales: initialData.locales,\n    defaultLocale,\n    domainLocales: initialData.domainLocales,\n    isPreview: initialData.isPreview,\n  })\n\n  initialMatchesMiddleware = await router._initialMatchesMiddlewarePromise\n\n  const renderCtx: RenderRouteInfo = {\n    App: CachedApp,\n    initial: true,\n    Component: CachedComponent,\n    props: initialData.props,\n    err: initialErr,\n    isHydratePass: true,\n  }\n\n  if (opts?.beforeRender) {\n    await opts.beforeRender()\n  }\n\n  render(renderCtx)\n}\n"],"names":["React","ReactDOM","HeadManagerContext","mitt","RouterContext","handleSmoothScroll","isDynamicRoute","urlQueryToSearchParams","assign","setConfig","getURL","loadGetInitialProps","ST","Portal","initHeadManager","PageLoader","RouteAnnouncer","createRouter","makePublicRouterInstance","getProperError","ImageConfigContext","removeBasePath","hasBasePath","AppRouterContext","adaptForAppRouterInstance","adaptForPathParams","adaptForSearchParams","PathnameContextProviderAdapter","SearchParamsContext","PathParamsContext","onRecoverableError","tracer","reportToSocket","version","process","env","__NEXT_VERSION","router","emitter","looseToArray","input","slice","call","initialData","defaultLocale","undefined","asPath","pageLoader","appElement","headManager","initialMatchesMiddleware","lastAppProps","lastRenderReject","devClient","CachedApp","onPerfEntry","CachedComponent","Container","Component","componentDidCatch","componentErr","info","props","fn","componentDidMount","scrollToHash","isSsr","isFallback","nextExport","pathname","location","search","__NEXT_HAS_REWRITES","__N_SSG","replace","String","query","URLSearchParams","_h","shallow","catch","err","cancelled","componentDidUpdate","hash","substring","el","document","getElementById","setTimeout","scrollIntoView","render","NODE_ENV","children","ReactDevOverlay","require","initialize","opts","onSpanEnd","JSON","parse","textContent","window","__NEXT_DATA__","prefix","assetPrefix","self","__next_set_public_path__","serverRuntimeConfig","publicRuntimeConfig","runtimeConfig","__NEXT_I18N_SUPPORT","normalizeLocalePath","detectDomainLocale","parseRelativeUrl","formatUrl","locales","parsedAs","localePathResult","detectedLocale","locale","detectedDomain","__NEXT_I18N_DOMAINS","hostname","scriptLoader","initScriptLoader","buildId","register","r","f","routeLoader","onEntrypoint","__NEXT_P","map","p","push","getIsSsr","renderApp","App","appProps","AppContainer","adaptedForAppRouter","useMemo","error","renderError","console","Provider","value","isAutoExport","autoExport","__NEXT_IMAGE_OPTS","wrapApp","wrappedAppProps","renderErrorProps","onUnrecoverableError","doRender","styleSheets","loadPage","then","page","ErrorComponent","errorModule","appModule","default","m","AppTree","appCtx","ctx","Promise","resolve","initProps","Head","callback","useLayoutEffect","performanceMarks","navigationStart","beforeRender","afterRender","afterHydrate","routeChange","performanceMeasures","hydration","beforeHydration","routeChangeToRender","reactRoot","shouldHydrate","clearMarks","forEach","mark","performance","markHydrateComplete","hasBeforeRenderMark","getEntriesByName","length","beforeHydrationMeasure","measure","hydrationMeasure","startSpan","startTime","timeOrigin","attributes","end","duration","markRenderComplete","navStartEntries","name","clearMeasures","renderReactElement","domEl","reactEl","hydrateRoot","startTransition","Root","callbacks","__NEXT_TEST_MODE","useEffect","__NEXT_HYDRATED","__NEXT_HYDRATED_CB","canceled","resolvePromise","renderPromise","reject","Error","onStart","currentStyleTags","querySelectorAll","currentHrefs","Set","tag","getAttribute","noscript","querySelector","nonce","href","text","has","styleTag","createElement","setAttribute","head","appendChild","createTextNode","onHeadCommit","desiredHrefs","s","idx","removeAttribute","referenceNode","targetTag","parentNode","insertBefore","nextSibling","removeChild","scroll","x","y","scrollTo","onRootCommit","elem","type","__NEXT_STRICT_MODE","StrictMode","renderingProps","isHydratePass","renderErr","hydrate","initialErr","appEntrypoint","whenEntrypoint","component","app","exports","mod","reportWebVitals","id","entryType","entries","attribution","uniqueID","Date","now","Math","floor","random","perfStartEntry","webVitals","label","pageEntrypoint","isValidElementType","getServerError","message","e","stack","source","__NEXT_PRELOADREADY","dynamicIds","initialProps","Boolean","subscription","Object","domainLocales","isPreview","_initialMatchesMiddlewarePromise","renderCtx","initial"],"mappings":"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"}