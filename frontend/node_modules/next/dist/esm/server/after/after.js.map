{"version":3,"sources":["../../../src/server/after/after.ts"],"sourcesContent":["import { getExpectedRequestStore } from '../../client/components/request-async-storage.external'\nimport { staticGenerationAsyncStorage } from '../../client/components/static-generation-async-storage.external'\nimport { StaticGenBailoutError } from '../../client/components/static-generation-bailout'\n\nimport { markCurrentScopeAsDynamic } from '../app-render/dynamic-rendering'\n\nexport type AfterTask<T = unknown> = Promise<T> | AfterCallback<T>\nexport type AfterCallback<T = unknown> = () => T | Promise<T>\n\n/**\n * This function allows you to schedule callbacks to be executed after the current request finishes.\n */\nexport function unstable_after<T>(task: AfterTask<T>) {\n  const callingExpression = 'unstable_after'\n\n  const requestStore = getExpectedRequestStore(callingExpression)\n\n  const { afterContext } = requestStore\n  if (!afterContext) {\n    throw new Error(\n      '`unstable_after()` must be explicitly enabled by setting `experimental.after: true` in your next.config.js.'\n    )\n  }\n\n  const staticGenerationStore = staticGenerationAsyncStorage.getStore()\n\n  if (staticGenerationStore) {\n    if (staticGenerationStore.forceStatic) {\n      throw new StaticGenBailoutError(\n        `Route ${staticGenerationStore.route} with \\`dynamic = \"force-static\"\\` couldn't be rendered statically because it used \\`${callingExpression}\\`. See more info here: https://nextjs.org/docs/app/building-your-application/rendering/static-and-dynamic#dynamic-rendering`\n      )\n    } else {\n      markCurrentScopeAsDynamic(staticGenerationStore, callingExpression)\n    }\n  }\n\n  return afterContext.after(task)\n}\n"],"names":["getExpectedRequestStore","staticGenerationAsyncStorage","StaticGenBailoutError","markCurrentScopeAsDynamic","unstable_after","task","callingExpression","requestStore","afterContext","Error","staticGenerationStore","getStore","forceStatic","route","after"],"mappings":"AAAA,SAASA,uBAAuB,QAAQ,yDAAwD;AAChG,SAASC,4BAA4B,QAAQ,mEAAkE;AAC/G,SAASC,qBAAqB,QAAQ,oDAAmD;AAEzF,SAASC,yBAAyB,QAAQ,kCAAiC;AAK3E;;CAEC,GACD,OAAO,SAASC,eAAkBC,IAAkB;IAClD,MAAMC,oBAAoB;IAE1B,MAAMC,eAAeP,wBAAwBM;IAE7C,MAAM,EAAEE,YAAY,EAAE,GAAGD;IACzB,IAAI,CAACC,cAAc;QACjB,MAAM,IAAIC,MACR;IAEJ;IAEA,MAAMC,wBAAwBT,6BAA6BU,QAAQ;IAEnE,IAAID,uBAAuB;QACzB,IAAIA,sBAAsBE,WAAW,EAAE;YACrC,MAAM,IAAIV,sBACR,CAAC,MAAM,EAAEQ,sBAAsBG,KAAK,CAAC,qFAAqF,EAAEP,kBAAkB,4HAA4H,CAAC;QAE/Q,OAAO;YACLH,0BAA0BO,uBAAuBJ;QACnD;IACF;IAEA,OAAOE,aAAaM,KAAK,CAACT;AAC5B"}