{"version":3,"sources":["../../../../src/lib/metadata/generate/meta.tsx"],"sourcesContent":["import React from 'react'\nimport { nonNullable } from '../../non-nullable'\n\nexport function Meta({\n  name,\n  property,\n  content,\n  media,\n}: {\n  name?: string\n  property?: string\n  media?: string\n  content: string | number | URL | null | undefined\n}): React.ReactElement | null {\n  if (typeof content !== 'undefined' && content !== null && content !== '') {\n    return (\n      <meta\n        {...(name ? { name } : { property })}\n        {...(media ? { media } : undefined)}\n        content={typeof content === 'string' ? content : content.toString()}\n      />\n    )\n  }\n  return null\n}\n\nexport function MetaFilter<T extends {} | {}[]>(\n  items: (T | null)[]\n): NonNullable<T>[] {\n  const acc: NonNullable<T>[] = []\n  for (const item of items) {\n    if (Array.isArray(item)) {\n      acc.push(...item.filter(nonNullable))\n    } else if (nonNullable(item)) {\n      acc.push(item)\n    }\n  }\n  return acc\n}\n\ntype ExtendMetaContent = Record<\n  string,\n  undefined | string | URL | number | boolean | null | undefined\n>\ntype MultiMetaContent =\n  | (ExtendMetaContent | string | URL | number)[]\n  | null\n  | undefined\n\nfunction camelToSnake(camelCaseStr: string) {\n  return camelCaseStr.replace(/([A-Z])/g, function (match) {\n    return '_' + match.toLowerCase()\n  })\n}\n\nfunction getMetaKey(prefix: string, key: string) {\n  // Use `twitter:image` and `og:image` instead of `twitter:image:url` and `og:image:url`\n  // to be more compatible as it's a more common format\n  if ((prefix === 'og:image' || prefix === 'twitter:image') && key === 'url') {\n    return prefix\n  }\n  if (prefix.startsWith('og:') || prefix.startsWith('twitter:')) {\n    key = camelToSnake(key)\n  }\n  return prefix + ':' + key\n}\n\nfunction ExtendMeta({\n  content,\n  namePrefix,\n  propertyPrefix,\n}: {\n  content?: ExtendMetaContent\n  namePrefix?: string\n  propertyPrefix?: string\n}) {\n  if (!content) return null\n  return MetaFilter(\n    Object.entries(content).map(([k, v]) => {\n      return typeof v === 'undefined'\n        ? null\n        : Meta({\n            ...(propertyPrefix && { property: getMetaKey(propertyPrefix, k) }),\n            ...(namePrefix && { name: getMetaKey(namePrefix, k) }),\n            content: typeof v === 'string' ? v : v?.toString(),\n          })\n    })\n  )\n}\n\nexport function MultiMeta({\n  propertyPrefix,\n  namePrefix,\n  contents,\n}: {\n  propertyPrefix?: string\n  namePrefix?: string\n  contents?: MultiMetaContent | null\n}) {\n  if (typeof contents === 'undefined' || contents === null) {\n    return null\n  }\n\n  return MetaFilter(\n    contents.map((content) => {\n      if (\n        typeof content === 'string' ||\n        typeof content === 'number' ||\n        content instanceof URL\n      ) {\n        return Meta({\n          ...(propertyPrefix\n            ? { property: propertyPrefix }\n            : { name: namePrefix }),\n          content,\n        })\n      } else {\n        return ExtendMeta({\n          namePrefix,\n          propertyPrefix,\n          content,\n        })\n      }\n    })\n  )\n}\n"],"names":["React","nonNullable","Meta","name","property","content","media","meta","undefined","toString","MetaFilter","items","acc","item","Array","isArray","push","filter","camelToSnake","camelCaseStr","replace","match","toLowerCase","getMetaKey","prefix","key","startsWith","ExtendMeta","namePrefix","propertyPrefix","Object","entries","map","k","v","MultiMeta","contents","URL"],"mappings":";AAAA,OAAOA,WAAW,QAAO;AACzB,SAASC,WAAW,QAAQ,qBAAoB;AAEhD,OAAO,SAASC,KAAK,EACnBC,IAAI,EACJC,QAAQ,EACRC,OAAO,EACPC,KAAK,EAMN;IACC,IAAI,OAAOD,YAAY,eAAeA,YAAY,QAAQA,YAAY,IAAI;QACxE,qBACE,KAACE;YACE,GAAIJ,OAAO;gBAAEA;YAAK,IAAI;gBAAEC;YAAS,CAAC;YAClC,GAAIE,QAAQ;gBAAEA;YAAM,IAAIE,SAAS;YAClCH,SAAS,OAAOA,YAAY,WAAWA,UAAUA,QAAQI,QAAQ;;IAGvE;IACA,OAAO;AACT;AAEA,OAAO,SAASC,WACdC,KAAmB;IAEnB,MAAMC,MAAwB,EAAE;IAChC,KAAK,MAAMC,QAAQF,MAAO;QACxB,IAAIG,MAAMC,OAAO,CAACF,OAAO;YACvBD,IAAII,IAAI,IAAIH,KAAKI,MAAM,CAAChB;QAC1B,OAAO,IAAIA,YAAYY,OAAO;YAC5BD,IAAII,IAAI,CAACH;QACX;IACF;IACA,OAAOD;AACT;AAWA,SAASM,aAAaC,YAAoB;IACxC,OAAOA,aAAaC,OAAO,CAAC,YAAY,SAAUC,KAAK;QACrD,OAAO,MAAMA,MAAMC,WAAW;IAChC;AACF;AAEA,SAASC,WAAWC,MAAc,EAAEC,GAAW;IAC7C,uFAAuF;IACvF,qDAAqD;IACrD,IAAI,AAACD,CAAAA,WAAW,cAAcA,WAAW,eAAc,KAAMC,QAAQ,OAAO;QAC1E,OAAOD;IACT;IACA,IAAIA,OAAOE,UAAU,CAAC,UAAUF,OAAOE,UAAU,CAAC,aAAa;QAC7DD,MAAMP,aAAaO;IACrB;IACA,OAAOD,SAAS,MAAMC;AACxB;AAEA,SAASE,WAAW,EAClBtB,OAAO,EACPuB,UAAU,EACVC,cAAc,EAKf;IACC,IAAI,CAACxB,SAAS,OAAO;IACrB,OAAOK,WACLoB,OAAOC,OAAO,CAAC1B,SAAS2B,GAAG,CAAC,CAAC,CAACC,GAAGC,EAAE;QACjC,OAAO,OAAOA,MAAM,cAChB,OACAhC,KAAK;YACH,GAAI2B,kBAAkB;gBAAEzB,UAAUmB,WAAWM,gBAAgBI;YAAG,CAAC;YACjE,GAAIL,cAAc;gBAAEzB,MAAMoB,WAAWK,YAAYK;YAAG,CAAC;YACrD5B,SAAS,OAAO6B,MAAM,WAAWA,IAAIA,qBAAAA,EAAGzB,QAAQ;QAClD;IACN;AAEJ;AAEA,OAAO,SAAS0B,UAAU,EACxBN,cAAc,EACdD,UAAU,EACVQ,QAAQ,EAKT;IACC,IAAI,OAAOA,aAAa,eAAeA,aAAa,MAAM;QACxD,OAAO;IACT;IAEA,OAAO1B,WACL0B,SAASJ,GAAG,CAAC,CAAC3B;QACZ,IACE,OAAOA,YAAY,YACnB,OAAOA,YAAY,YACnBA,mBAAmBgC,KACnB;YACA,OAAOnC,KAAK;gBACV,GAAI2B,iBACA;oBAAEzB,UAAUyB;gBAAe,IAC3B;oBAAE1B,MAAMyB;gBAAW,CAAC;gBACxBvB;YACF;QACF,OAAO;YACL,OAAOsB,WAAW;gBAChBC;gBACAC;gBACAxB;YACF;QACF;IACF;AAEJ"}