{"version":3,"sources":["../../src/cli/next-dev.ts"],"sourcesContent":["#!/usr/bin/env node\n\nimport '../server/lib/cpu-profile'\nimport type { StartServerOptions } from '../server/lib/start-server'\nimport {\n  RESTART_EXIT_CODE,\n  getNodeDebugType,\n  getParsedDebugAddress,\n  getMaxOldSpaceSize,\n  getParsedNodeOptionsWithoutInspect,\n  printAndExit,\n  formatNodeOptions,\n  formatDebugAddress,\n} from '../server/lib/utils'\nimport * as Log from '../build/output/log'\nimport { getProjectDir } from '../lib/get-project-dir'\nimport { PHASE_DEVELOPMENT_SERVER } from '../shared/lib/constants'\nimport path from 'path'\nimport type { NextConfigComplete } from '../server/config-shared'\nimport { setGlobal, traceGlobals } from '../trace/shared'\nimport { Telemetry } from '../telemetry/storage'\nimport loadConfig from '../server/config'\nimport { findPagesDir } from '../lib/find-pages-dir'\nimport { fileExists, FileType } from '../lib/file-exists'\nimport { getNpxCommand } from '../lib/helpers/get-npx-command'\nimport { createSelfSignedCertificate } from '../lib/mkcert'\nimport type { SelfSignedCertificate } from '../lib/mkcert'\nimport uploadTrace from '../trace/upload-trace'\nimport { initialEnv } from '@next/env'\nimport { fork } from 'child_process'\nimport type { ChildProcess } from 'child_process'\nimport {\n  getReservedPortExplanation,\n  isPortIsReserved,\n} from '../lib/helpers/get-reserved-port'\nimport os from 'os'\nimport { once } from 'node:events'\n\ntype NextDevOptions = {\n  turbo?: boolean\n  port: number\n  hostname?: string\n  experimentalHttps?: boolean\n  experimentalHttpsKey?: string\n  experimentalHttpsCert?: string\n  experimentalHttpsCa?: string\n  experimentalUploadTrace?: string\n}\n\ntype PortSource = 'cli' | 'default' | 'env'\n\nlet dir: string\nlet child: undefined | ChildProcess\nlet config: NextConfigComplete\nlet isTurboSession = false\nlet traceUploadUrl: string\nlet sessionStopHandled = false\nlet sessionStarted = Date.now()\n\nconst handleSessionStop = async (signal: NodeJS.Signals | number | null) => {\n  if (child?.pid) child.kill(signal ?? 0)\n  if (sessionStopHandled) return\n  sessionStopHandled = true\n\n  if (child?.pid && child.exitCode === null && child.signalCode === null) {\n    await once(child, 'exit').catch(() => {})\n  }\n\n  try {\n    const { eventCliSessionStopped } =\n      require('../telemetry/events/session-stopped') as typeof import('../telemetry/events/session-stopped')\n\n    config = config || (await loadConfig(PHASE_DEVELOPMENT_SERVER, dir))\n\n    let telemetry =\n      (traceGlobals.get('telemetry') as InstanceType<\n        typeof import('../telemetry/storage').Telemetry\n      >) ||\n      new Telemetry({\n        distDir: path.join(dir, config.distDir),\n      })\n\n    let pagesDir: boolean = !!traceGlobals.get('pagesDir')\n    let appDir: boolean = !!traceGlobals.get('appDir')\n\n    if (\n      typeof traceGlobals.get('pagesDir') === 'undefined' ||\n      typeof traceGlobals.get('appDir') === 'undefined'\n    ) {\n      const pagesResult = findPagesDir(dir)\n      appDir = !!pagesResult.appDir\n      pagesDir = !!pagesResult.pagesDir\n    }\n\n    telemetry.record(\n      eventCliSessionStopped({\n        cliCommand: 'dev',\n        turboFlag: isTurboSession,\n        durationMilliseconds: Date.now() - sessionStarted,\n        pagesDir,\n        appDir,\n      }),\n      true\n    )\n    telemetry.flushDetached('dev', dir)\n  } catch (_) {\n    // errors here aren't actionable so don't add\n    // noise to the output\n  }\n\n  if (traceUploadUrl) {\n    uploadTrace({\n      traceUploadUrl,\n      mode: 'dev',\n      projectDir: dir,\n      distDir: config.distDir,\n    })\n  }\n\n  // ensure we re-enable the terminal cursor before exiting\n  // the program, or the cursor could remain hidden\n  process.stdout.write('\\x1B[?25h')\n  process.stdout.write('\\n')\n  process.exit(0)\n}\n\nprocess.on('SIGINT', () => handleSessionStop('SIGKILL'))\nprocess.on('SIGTERM', () => handleSessionStop('SIGKILL'))\n\n// exit event must be synchronous\nprocess.on('exit', () => child?.kill('SIGKILL'))\n\nconst nextDev = async (\n  options: NextDevOptions,\n  portSource: PortSource,\n  directory?: string\n) => {\n  dir = getProjectDir(process.env.NEXT_PRIVATE_DEV_DIR || directory)\n\n  // Check if pages dir exists and warn if not\n  if (!(await fileExists(dir, FileType.Directory))) {\n    printAndExit(`> No such directory exists as the project root: ${dir}`)\n  }\n\n  async function preflight(skipOnReboot: boolean) {\n    const { getPackageVersion, getDependencies } = (await Promise.resolve(\n      require('../lib/get-package-version')\n    )) as typeof import('../lib/get-package-version')\n\n    const [sassVersion, nodeSassVersion] = await Promise.all([\n      getPackageVersion({ cwd: dir, name: 'sass' }),\n      getPackageVersion({ cwd: dir, name: 'node-sass' }),\n    ])\n    if (sassVersion && nodeSassVersion) {\n      Log.warn(\n        'Your project has both `sass` and `node-sass` installed as dependencies, but should only use one or the other. ' +\n          'Please remove the `node-sass` dependency from your project. ' +\n          ' Read more: https://nextjs.org/docs/messages/duplicate-sass'\n      )\n    }\n\n    if (!skipOnReboot) {\n      const { dependencies, devDependencies } = await getDependencies({\n        cwd: dir,\n      })\n\n      // Warn if @next/font is installed as a dependency. Ignore `workspace:*` to not warn in the Next.js monorepo.\n      if (\n        dependencies['@next/font'] ||\n        (devDependencies['@next/font'] &&\n          devDependencies['@next/font'] !== 'workspace:*')\n      ) {\n        const command = getNpxCommand(dir)\n        Log.warn(\n          'Your project has `@next/font` installed as a dependency, please use the built-in `next/font` instead. ' +\n            'The `@next/font` package will be removed in Next.js 14. ' +\n            `You can migrate by running \\`${command} @next/codemod@latest built-in-next-font .\\`. Read more: https://nextjs.org/docs/messages/built-in-next-font`\n        )\n      }\n    }\n  }\n\n  const port = options.port\n\n  if (isPortIsReserved(port)) {\n    printAndExit(getReservedPortExplanation(port), 1)\n  }\n\n  // If neither --port nor PORT were specified, it's okay to retry new ports.\n  const allowRetry = portSource === 'default'\n\n  // We do not set a default host value here to prevent breaking\n  // some set-ups that rely on listening on other interfaces\n  const host = options.hostname\n\n  config = await loadConfig(PHASE_DEVELOPMENT_SERVER, dir)\n\n  if (\n    options.experimentalUploadTrace &&\n    !process.env.NEXT_TRACE_UPLOAD_DISABLED\n  ) {\n    traceUploadUrl = options.experimentalUploadTrace\n  }\n\n  const devServerOptions: StartServerOptions = {\n    dir,\n    port,\n    allowRetry,\n    isDev: true,\n    hostname: host,\n  }\n\n  if (options.turbo) {\n    process.env.TURBOPACK = '1'\n  }\n\n  isTurboSession = !!process.env.TURBOPACK\n\n  const distDir = path.join(dir, config.distDir ?? '.next')\n  setGlobal('phase', PHASE_DEVELOPMENT_SERVER)\n  setGlobal('distDir', distDir)\n\n  const startServerPath = require.resolve('../server/lib/start-server')\n\n  async function startServer(startServerOptions: StartServerOptions) {\n    return new Promise<void>((resolve) => {\n      let resolved = false\n      const defaultEnv = (initialEnv || process.env) as typeof process.env\n\n      const nodeOptions = getParsedNodeOptionsWithoutInspect()\n      const nodeDebugType = getNodeDebugType()\n\n      let maxOldSpaceSize: string | number | undefined = getMaxOldSpaceSize()\n      if (!maxOldSpaceSize && !process.env.NEXT_DISABLE_MEM_OVERRIDE) {\n        const totalMem = os.totalmem()\n        const totalMemInMB = Math.floor(totalMem / 1024 / 1024)\n        maxOldSpaceSize = Math.floor(totalMemInMB * 0.5).toString()\n\n        nodeOptions['max-old-space-size'] = maxOldSpaceSize\n\n        // Ensure the max_old_space_size is not also set.\n        delete nodeOptions['max_old_space_size']\n      }\n\n      if (nodeDebugType) {\n        const address = getParsedDebugAddress()\n        address.port = address.port + 1\n        nodeOptions[nodeDebugType] = formatDebugAddress(address)\n      }\n\n      child = fork(startServerPath, {\n        stdio: 'inherit',\n        env: {\n          ...defaultEnv,\n          TURBOPACK: process.env.TURBOPACK,\n          NEXT_PRIVATE_WORKER: '1',\n          NODE_EXTRA_CA_CERTS: startServerOptions.selfSignedCertificate\n            ? startServerOptions.selfSignedCertificate.rootCA\n            : defaultEnv.NODE_EXTRA_CA_CERTS,\n          NODE_OPTIONS: formatNodeOptions(nodeOptions),\n        },\n      })\n\n      child.on('message', (msg: any) => {\n        if (msg && typeof msg === 'object') {\n          if (msg.nextWorkerReady) {\n            child?.send({ nextWorkerOptions: startServerOptions })\n          } else if (msg.nextServerReady && !resolved) {\n            resolved = true\n            resolve()\n          }\n        }\n      })\n\n      child.on('exit', async (code, signal) => {\n        if (sessionStopHandled || signal) {\n          return\n        }\n        if (code === RESTART_EXIT_CODE) {\n          // Starting the dev server will overwrite the `.next/trace` file, so we\n          // must upload the existing contents before restarting the server to\n          // preserve the metrics.\n          if (traceUploadUrl) {\n            uploadTrace({\n              traceUploadUrl,\n              mode: 'dev',\n              projectDir: dir,\n              distDir: config.distDir,\n              sync: true,\n            })\n          }\n          return startServer(startServerOptions)\n        }\n        await handleSessionStop(signal)\n      })\n    })\n  }\n\n  const runDevServer = async (reboot: boolean) => {\n    try {\n      if (!!options.experimentalHttps) {\n        Log.warn(\n          'Self-signed certificates are currently an experimental feature, use with caution.'\n        )\n\n        let certificate: SelfSignedCertificate | undefined\n\n        const key = options.experimentalHttpsKey\n        const cert = options.experimentalHttpsCert\n        const rootCA = options.experimentalHttpsCa\n\n        if (key && cert) {\n          certificate = {\n            key: path.resolve(key),\n            cert: path.resolve(cert),\n            rootCA: rootCA ? path.resolve(rootCA) : undefined,\n          }\n        } else {\n          certificate = await createSelfSignedCertificate(host)\n        }\n\n        await startServer({\n          ...devServerOptions,\n          selfSignedCertificate: certificate,\n        })\n      } else {\n        await startServer(devServerOptions)\n      }\n\n      await preflight(reboot)\n    } catch (err) {\n      console.error(err)\n      process.exit(1)\n    }\n  }\n\n  await runDevServer(false)\n}\n\nexport { nextDev }\n"],"names":["nextDev","dir","child","config","isTurboSession","traceUploadUrl","sessionStopHandled","sessionStarted","Date","now","handleSessionStop","signal","pid","kill","exitCode","signalCode","once","catch","eventCliSessionStopped","require","loadConfig","PHASE_DEVELOPMENT_SERVER","telemetry","traceGlobals","get","Telemetry","distDir","path","join","pagesDir","appDir","pagesResult","findPagesDir","record","cliCommand","turboFlag","durationMilliseconds","flushDetached","_","uploadTrace","mode","projectDir","process","stdout","write","exit","on","options","portSource","directory","getProjectDir","env","NEXT_PRIVATE_DEV_DIR","fileExists","FileType","Directory","printAndExit","preflight","skipOnReboot","getPackageVersion","getDependencies","Promise","resolve","sassVersion","nodeSassVersion","all","cwd","name","Log","warn","dependencies","devDependencies","command","getNpxCommand","port","isPortIsReserved","getReservedPortExplanation","allowRetry","host","hostname","experimentalUploadTrace","NEXT_TRACE_UPLOAD_DISABLED","devServerOptions","isDev","turbo","TURBOPACK","setGlobal","startServerPath","startServer","startServerOptions","resolved","defaultEnv","initialEnv","nodeOptions","getParsedNodeOptionsWithoutInspect","nodeDebugType","getNodeDebugType","maxOldSpaceSize","getMaxOldSpaceSize","NEXT_DISABLE_MEM_OVERRIDE","totalMem","os","totalmem","totalMemInMB","Math","floor","toString","address","getParsedDebugAddress","formatDebugAddress","fork","stdio","NEXT_PRIVATE_WORKER","NODE_EXTRA_CA_CERTS","selfSignedCertificate","rootCA","NODE_OPTIONS","formatNodeOptions","msg","nextWorkerReady","send","nextWorkerOptions","nextServerReady","code","RESTART_EXIT_CODE","sync","runDevServer","reboot","experimentalHttps","certificate","key","experimentalHttpsKey","cert","experimentalHttpsCert","experimentalHttpsCa","undefined","createSelfSignedCertificate","err","console","error"],"mappings":"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"}