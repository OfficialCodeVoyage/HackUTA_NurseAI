{"version":3,"sources":["../../../src/client/components/prerender-indicator.ts"],"sourcesContent":["import type { ShowHideHandler } from '../dev/dev-build-watcher'\n\nexport default function initializePrerenderIndicator(\n  toggleCallback: (handlers: ShowHideHandler) => void\n) {\n  const shadowHost = document.createElement('div')\n  shadowHost.id = '__next-prerender-indicator'\n  // Make sure container is fixed and on a high zIndex so it shows\n  shadowHost.style.position = 'fixed'\n  shadowHost.style.bottom = '20px'\n  shadowHost.style.right = '10px'\n  shadowHost.style.width = '0'\n  shadowHost.style.height = '0'\n  shadowHost.style.zIndex = '99998'\n  shadowHost.style.transition = 'all 100ms ease'\n\n  document.body.appendChild(shadowHost)\n\n  let shadowRoot\n  let prefix = ''\n\n  if (shadowHost.attachShadow) {\n    shadowRoot = shadowHost.attachShadow({ mode: 'open' })\n  } else {\n    // If attachShadow is undefined then the browser does not support\n    // the Shadow DOM, we need to prefix all the names so there\n    // will be no conflicts\n    shadowRoot = shadowHost\n    prefix = '__next-prerender-indicator-'\n  }\n\n  // Container\n  const container = createContainer(prefix)\n  shadowRoot.appendChild(container)\n\n  // CSS\n  const css = createCss(prefix)\n  shadowRoot.appendChild(css)\n\n  const expandEl = container.querySelector('a')\n  const closeEl: HTMLDivElement | null = container.querySelector(\n    `#${prefix}close`\n  ) as any\n\n  if (closeEl) {\n    closeEl.title = 'Click to disable indicator for one hour in this session'\n  }\n\n  // State\n  const dismissKey = '__NEXT_DISMISS_PRERENDER_INDICATOR'\n  const dismissUntil = parseInt(\n    window.localStorage.getItem(dismissKey) || '',\n    10\n  )\n  const dismissed = dismissUntil > new Date().getTime()\n\n  if (dismissed) return\n\n  let isVisible = false\n\n  function updateContainer() {\n    if (isVisible) {\n      container.classList.add(`${prefix}visible`)\n    } else {\n      container.classList.remove(`${prefix}visible`)\n    }\n  }\n  const expandedClass = `${prefix}expanded`\n  let toggleTimeout: ReturnType<typeof setTimeout>\n\n  const toggleExpand = (expand = true) => {\n    clearTimeout(toggleTimeout)\n\n    toggleTimeout = setTimeout(() => {\n      if (expand) {\n        expandEl?.classList.add(expandedClass)\n        if (closeEl) {\n          closeEl.style.display = 'flex'\n        }\n      } else {\n        expandEl?.classList.remove(expandedClass)\n        if (closeEl) {\n          closeEl.style.display = 'none'\n        }\n      }\n    }, 50)\n  }\n\n  closeEl?.addEventListener('click', () => {\n    const oneHourAway = new Date().getTime() + 1 * 60 * 60 * 1000\n    window.localStorage.setItem(dismissKey, oneHourAway + '')\n    isVisible = false\n    updateContainer()\n  })\n  closeEl?.addEventListener('mouseenter', () => toggleExpand())\n  closeEl?.addEventListener('mouseleave', () => toggleExpand(false))\n  expandEl?.addEventListener('mouseenter', () => toggleExpand())\n  expandEl?.addEventListener('mouseleave', () => toggleExpand(false))\n\n  toggleCallback({\n    show: () => {\n      isVisible = true\n      updateContainer()\n    },\n    hide: () => {\n      isVisible = false\n      updateContainer()\n    },\n  })\n}\n\nfunction createContainer(prefix: string) {\n  const container = document.createElement('div')\n  container.id = `${prefix}container`\n  container.innerHTML = `\n    <button id=\"${prefix}close\" title=\"Hide indicator for session\">\n      <span>Ã—</span>\n    </button>\n    <a href=\"https://nextjs.org/docs/app/api-reference/next-config-js/devIndicators\" target=\"_blank\" rel=\"noreferrer\">\n      <div id=\"${prefix}icon-wrapper\">\n          <svg width=\"15\" height=\"20\" viewBox=\"0 0 60 80\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path d=\"M36 3L30.74 41H8L36 3Z\" fill=\"black\"/>\n          <path d=\"M25 77L30.26 39H53L25 77Z\" fill=\"black\"/>\n          <path d=\"M13.5 33.5L53 39L47.5 46.5L7 41.25L13.5 33.5Z\" fill=\"black\"/>\n          </svg>\n          Prerendered Page\n      </div>\n    </a>\n  `\n  return container\n}\n\nfunction createCss(prefix: string) {\n  const css = document.createElement('style')\n  css.textContent = `\n    #${prefix}container {\n      position: absolute;\n      display: none;\n      bottom: 10px;\n      right: 15px;\n    }\n\n    #${prefix}close {\n      top: -10px;\n      right: -10px;\n      border: none;\n      width: 18px;\n      height: 18px;\n      color: #333333;\n      font-size: 16px;\n      cursor: pointer;\n      display: none;\n      position: absolute;\n      background: #ffffff;\n      border-radius: 100%;\n      align-items: center;\n      flex-direction: column;\n      justify-content: center;\n    }\n\n    #${prefix}container a {\n      color: inherit;\n      text-decoration: none;\n      width: 15px;\n      height: 23px;\n      overflow: hidden;\n\n      border-radius: 3px;\n      background: #fff;\n      color: #000;\n      font: initial;\n      cursor: pointer;\n      letter-spacing: initial;\n      text-shadow: initial;\n      text-transform: initial;\n      visibility: initial;\n      font-size: 14px;\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\n\n      padding: 4px 2px;\n      align-items: center;\n      box-shadow: 0 11px 40px 0 rgba(0, 0, 0, 0.25), 0 2px 10px 0 rgba(0, 0, 0, 0.12);\n\n      display: flex;\n      transition: opacity 0.1s ease, bottom 0.1s ease, width 0.3s ease;\n      animation: ${prefix}fade-in 0.1s ease-in-out;\n    }\n\n    #${prefix}icon-wrapper {\n      width: 140px;\n      height: 20px;\n      display: flex;\n      flex-shrink: 0;\n      align-items: center;\n      position: relative;\n    }\n\n    #${prefix}icon-wrapper svg {\n      flex-shrink: 0;\n      margin-right: 3px;\n    }\n\n    #${prefix}container a.${prefix}expanded {\n      width: 135px;\n    }\n\n    #${prefix}container.${prefix}visible {\n      display: flex;\n      bottom: 10px;\n      opacity: 1;\n    }\n\n    @keyframes ${prefix}fade-in {\n      from {\n        bottom: 0px;\n        opacity: 0;\n      }\n      to {\n        bottom: 10px;\n        opacity: 1;\n      }\n    }\n  `\n\n  return css\n}\n"],"names":["initializePrerenderIndicator","toggleCallback","shadowHost","document","createElement","id","style","position","bottom","right","width","height","zIndex","transition","body","appendChild","shadowRoot","prefix","attachShadow","mode","container","createContainer","css","createCss","expandEl","querySelector","closeEl","title","dismissKey","dismissUntil","parseInt","window","localStorage","getItem","dismissed","Date","getTime","isVisible","updateContainer","classList","add","remove","expandedClass","toggleTimeout","toggleExpand","expand","clearTimeout","setTimeout","display","addEventListener","oneHourAway","setItem","show","hide","innerHTML","textContent"],"mappings":";;;;+BAEA;;;eAAwBA;;;AAAT,SAASA,6BACtBC,cAAmD;IAEnD,MAAMC,aAAaC,SAASC,aAAa,CAAC;IAC1CF,WAAWG,EAAE,GAAG;IAChB,gEAAgE;IAChEH,WAAWI,KAAK,CAACC,QAAQ,GAAG;IAC5BL,WAAWI,KAAK,CAACE,MAAM,GAAG;IAC1BN,WAAWI,KAAK,CAACG,KAAK,GAAG;IACzBP,WAAWI,KAAK,CAACI,KAAK,GAAG;IACzBR,WAAWI,KAAK,CAACK,MAAM,GAAG;IAC1BT,WAAWI,KAAK,CAACM,MAAM,GAAG;IAC1BV,WAAWI,KAAK,CAACO,UAAU,GAAG;IAE9BV,SAASW,IAAI,CAACC,WAAW,CAACb;IAE1B,IAAIc;IACJ,IAAIC,SAAS;IAEb,IAAIf,WAAWgB,YAAY,EAAE;QAC3BF,aAAad,WAAWgB,YAAY,CAAC;YAAEC,MAAM;QAAO;IACtD,OAAO;QACL,iEAAiE;QACjE,2DAA2D;QAC3D,uBAAuB;QACvBH,aAAad;QACbe,SAAS;IACX;IAEA,YAAY;IACZ,MAAMG,YAAYC,gBAAgBJ;IAClCD,WAAWD,WAAW,CAACK;IAEvB,MAAM;IACN,MAAME,MAAMC,UAAUN;IACtBD,WAAWD,WAAW,CAACO;IAEvB,MAAME,WAAWJ,UAAUK,aAAa,CAAC;IACzC,MAAMC,UAAiCN,UAAUK,aAAa,CAC5D,AAAC,MAAGR,SAAO;IAGb,IAAIS,SAAS;QACXA,QAAQC,KAAK,GAAG;IAClB;IAEA,QAAQ;IACR,MAAMC,aAAa;IACnB,MAAMC,eAAeC,SACnBC,OAAOC,YAAY,CAACC,OAAO,CAACL,eAAe,IAC3C;IAEF,MAAMM,YAAYL,eAAe,IAAIM,OAAOC,OAAO;IAEnD,IAAIF,WAAW;IAEf,IAAIG,YAAY;IAEhB,SAASC;QACP,IAAID,WAAW;YACbjB,UAAUmB,SAAS,CAACC,GAAG,CAAC,AAAC,KAAEvB,SAAO;QACpC,OAAO;YACLG,UAAUmB,SAAS,CAACE,MAAM,CAAC,AAAC,KAAExB,SAAO;QACvC;IACF;IACA,MAAMyB,gBAAgB,AAAC,KAAEzB,SAAO;IAChC,IAAI0B;IAEJ,MAAMC,eAAe,CAACC;YAAAA,mBAAAA,SAAS;QAC7BC,aAAaH;QAEbA,gBAAgBI,WAAW;YACzB,IAAIF,QAAQ;gBACVrB,4BAAAA,SAAUe,SAAS,CAACC,GAAG,CAACE;gBACxB,IAAIhB,SAAS;oBACXA,QAAQpB,KAAK,CAAC0C,OAAO,GAAG;gBAC1B;YACF,OAAO;gBACLxB,4BAAAA,SAAUe,SAAS,CAACE,MAAM,CAACC;gBAC3B,IAAIhB,SAAS;oBACXA,QAAQpB,KAAK,CAAC0C,OAAO,GAAG;gBAC1B;YACF;QACF,GAAG;IACL;IAEAtB,2BAAAA,QAASuB,gBAAgB,CAAC,SAAS;QACjC,MAAMC,cAAc,IAAIf,OAAOC,OAAO,KAAK,IAAI,KAAK,KAAK;QACzDL,OAAOC,YAAY,CAACmB,OAAO,CAACvB,YAAYsB,cAAc;QACtDb,YAAY;QACZC;IACF;IACAZ,2BAAAA,QAASuB,gBAAgB,CAAC,cAAc,IAAML;IAC9ClB,2BAAAA,QAASuB,gBAAgB,CAAC,cAAc,IAAML,aAAa;IAC3DpB,4BAAAA,SAAUyB,gBAAgB,CAAC,cAAc,IAAML;IAC/CpB,4BAAAA,SAAUyB,gBAAgB,CAAC,cAAc,IAAML,aAAa;IAE5D3C,eAAe;QACbmD,MAAM;YACJf,YAAY;YACZC;QACF;QACAe,MAAM;YACJhB,YAAY;YACZC;QACF;IACF;AACF;AAEA,SAASjB,gBAAgBJ,MAAc;IACrC,MAAMG,YAAYjB,SAASC,aAAa,CAAC;IACzCgB,UAAUf,EAAE,GAAG,AAAC,KAAEY,SAAO;IACzBG,UAAUkC,SAAS,GAAG,AAAC,uBACPrC,SAAO,gOAIRA,SAAO;IAUtB,OAAOG;AACT;AAEA,SAASG,UAAUN,MAAc;IAC/B,MAAMK,MAAMnB,SAASC,aAAa,CAAC;IACnCkB,IAAIiC,WAAW,GAAG,AAAC,YACdtC,SAAO,0HAOPA,SAAO,6YAkBPA,SAAO,syBAyBKA,SAAO,8CAGnBA,SAAO,iLASPA,SAAO,wFAKPA,SAAO,iBAAcA,SAAO,oDAI5BA,SAAO,eAAYA,SAAO,sGAMhBA,SAAO;IAYtB,OAAOK;AACT"}